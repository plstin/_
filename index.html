<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>يوسف</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f0f2f5;
      color: #222;
      direction: rtl;
      text-align: right;
    }

    main {
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }

    #flagContainer {
      text-align: center;
      margin-bottom: 10px;
    }

    #flagContainer img {
      width: 60px;
      height: auto;
      border-radius: 5px;
    }

    #infoBox {
      background-color: #fff9e6;
      border-right: 5px solid #ff9900;
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 10px;
      font-size: 14px;
      line-height: 1.6;
    }

    #reminderLine {
      font-size: 13px;
      color: #333;
      margin-bottom: 20px;
    }

    #offerList {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
    }

    .offer-card {
      background: #fff;
      border-radius: 10px;
      padding: 10px;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s ease;
      display: flex;
      align-items: center;
    }

    .offer-card:hover {
      transform: scale(1.02);
    }

    .offer-card img {
      width: 30%;
      height: 90px;
      object-fit: cover;
      border-radius: 8px;
      margin-left: 10px;
      flex-shrink: 0;
    }

    .offer-text {
      width: 70%;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .offer-title {
      font-size: 14px;
      font-weight: bold;
      white-space: normal;
      overflow: visible;
    }

    #loading {
      text-align: center;
      margin-top: 20px;
      font-size: 16px;
    }

    #noOffersMsg {
      color: red;
      white-space: normal;
      margin-top: 10px;
    }

    @media (max-width: 1000px) {
      #offerList {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 700px) {
      #offerList {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 400px) {
      #offerList {
        grid-template-columns: 1fr;
      }
      .offer-card {
        flex-direction: column;
        align-items: flex-start;
      }
      .offer-card img {
        width: 100%;
        margin-left: 0;
        margin-bottom: 10px;
      }
      .offer-text {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <main>
    <div id="flagContainer">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/00/Flag_of_Palestine.svg" alt="علم فلسطين">
    </div>

    <div id="infoBox"></div>
    <div id="reminderLine"></div>
    <div id="offerList"></div>
    <div id="noOffersMsg"></div>
    <div id="loading">...</div>
  </main>

  <script>
    const infoBox = document.getElementById("infoBox");
    const reminderLine = document.getElementById("reminderLine");
    const offerList = document.getElementById("offerList");
    const noOffersMsg = document.getElementById("noOffersMsg");
    const loading = document.getElementById("loading");

    const arabicCountries = ["AE","SA","EG","IQ","JO","KW","LB","LY","MA","OM","QA","SD","SY","TN","YE","BH"];
    let isArabic = true;

    async function detectLanguage() {
      try {
        const res = await fetch("https://ipapi.co/json/");
        const data = await res.json();
        isArabic = arabicCountries.includes(data.country_code);
        document.documentElement.lang = isArabic ? "ar" : "en";
        document.body.style.direction = isArabic ? "rtl" : "ltr";
        document.body.style.textAlign = isArabic ? "right" : "left";
      } catch (err) {
        console.error(err);
      }
    }

    function translateOfferTitle(title) {
      if (!title) return "";
      if (isArabic) return title + " (AR)"; // replace with real Arabic translation if desired
      return title;
    }

    function createOfferCard(offer) {
      const card = document.createElement("div");
      card.className = "offer-card";

      const img = document.createElement("img");
      img.src = offer.picture || "";
      card.appendChild(img);

      const textContainer = document.createElement("div");
      textContainer.className = "offer-text";

      const title = document.createElement("div");
      title.className = "offer-title";
      title.textContent = isArabic ? translateOfferTitle(offer.name_short || offer.name) : offer.name_short || offer.name;
      textContainer.appendChild(title);

      card.appendChild(textContainer);
      card.onclick = () => window.open(offer.link, "_blank");

      return card;
    }

    async function fetchCPAGripOffers() {
      try {
        const url = "https://www.cpagrip.com/common/offer_feed_json.php?user_id=2439739&pubkey=23311a81282b777eab88a6d19f0d9493";
        const res = await fetch(url);
        const data = await res.json();
        const list = Array.isArray(data) ? data : (data.offers || []);
        return list.filter(o => parseFloat(o.payout) >= 0.5)
                   .filter(o => (o.adcopy || o.description || "") !== "Enter your information now for a chance to win.");
      } catch {
        return [];
      }
    }

    async function loadOffers() {
      loading.style.display = "block";
      try {
        const offers = await fetchCPAGripOffers();
        offerList.innerHTML = "";
        noOffersMsg.textContent = "";

        // ALWAYS set info/reminder text
        infoBox.textContent = isArabic
          ? "السلام عليكم، إسمي يوسف من فلسطين و حلمي هو أن أصبح مطورا ناجحا، لأكون مصدر فخر لوطني، فلهذا يجب علي الحصول على كمبيوتر، و يمكنكم مساعدتي عن طريق التسجيل بالمجان في المواقع أسفله، فهي تكافئني مقابل الترويج لها، الأمر لا يتطلب أكثر من دقيقة لكل موقع، كلما تسجلتم في مواقع أكثر كلما إقتربت من تحقيق حلمي، و أرجو منكم الدعاء لوالدي بالمغفرة."
          : "Hello, my name is Youssef from Palestine. My dream is to become a successful developer and make my country proud. You can help me by signing up for the free sites below. Each sign-up takes only a minute, and the more you register, the closer I get to my dream. Please pray for my father's forgiveness.";

        reminderLine.textContent = isArabic
          ? "حتى بعد إنتهاءكم من جميع التسجيلات، يمكنكم العودة لاحقا لأنني سأضيف مواقع جديدة بإستمرار"
          : "Even after completing all sign-ups, you can come back later as I will continuously add new sites.";

        if (!offers.length) {
          noOffersMsg.textContent = isArabic
            ? "لا يوجد أي مواقع للترويج لها في بلدك حاليا، يمكنك الرجوع لاحقا"
            : "There are no promotional sites available in your country currently, please check back later.";
          return;
        }

        offers.sort((a, b) => parseFloat(b.payout) - parseFloat(a.payout))
              .forEach(o => offerList.appendChild(createOfferCard(o)));
      } finally {
        loading.style.display = "none";
      }
    }

    detectLanguage().then(loadOffers);
  </script>
</body>
</html>
